# Gulp Email Boilerplate
Boilerplate for email builds. With this decoupled workflow you can use externally referenced SASS files and compile the resulting CSS inline.

THIS ONLY WORKS WITH NODE V11. SEE THIS - https://stackoverflow.com/questions/55921442/how-to-fix-referenceerror-primordials-is-not-defined-in-node

## Primary Tasks
1. `$ gulp` - This is the default task. It will process all the files inside the 'src' folder and then launch browserSync in your default browser.
1. `$ gulp prod` - This will run a few tasks and output all the necessary files in to a folder called 'production':

   1. Firstly it will run a task called `uncss`, which removes any styles that haven't been used.
   2. It then runs a task called `inline`, which will inline all your CSS. This passes a few (configurable) parameters:
      * **removeLinkTags**: This will remove the link tags in the head of the document
      * **preserveMediaQueries**: Preserves all media queries (and contained styles) within <style></style> tags when removeStyleTags is true. This isn't applicable with the current set up, but left it in just as a safety measure.
      * **applyWidthAttributes**: Uses CSS pixel widths to create width attributes on elements
      * **applyTableAttributes**: Automatically applies the border, cellpadding and cellspacing attributes to table elements (False by default)
Click here for a full list of settings - https://www.npmjs.com/package/gulp-inline-css
3. Finally it runs a task called `copy-images`, which simply copies the images folder in to the production folder

## Secondary tasks
1. `$ gulp sendmail` - This will send emails out using the Home Mailgun server. By default it will send out tests for all HTML files inside the **production** folder, to the Home Litmus account. Please configure appropriately, as we have a maximum amount of tests we can send out before being charged
2. `$ gulp ftp` - Uploads the images folder to our external images server. The settings in this task must be configured appropriately using the naming convention of *public/year/client/project* . Once uploaded, just do a find and replace inside your HTML to reference the new images path
3. `$ gulp clean` - Deletes everything inside the **dist** folder
4. `$ gulp scss-lint` - Lints your SCSS files. Please see the [Barebones HTML boilerplate](https://gitlab.home-trial.com/infrastructure/gulp-barebones-boilerplate) for setup and usage details.

## Nunjucks and external data sources
For scalability and ease of management, it might be a good idea to decouple your data from your HTML. This project references a local json file, but it's possible to reference externally as well. Take a look inside email-template-1.html, email-template-2.html and partial.html to see how this works.

## Important
### Google Fonts
If you're including Google fonts in a template, they must be included like this:

```
<style>
    @import url('https://fonts.googleapis.com/css?family=Lato:900');
</style>
```

This is due to the style tags being stripped out once the production task has run.

### Self closing tags
If you need to use self closing tags in your template (such as those generated by a CRM), then you must add the setting `xmlMode: true` to your inlineCss settings in the gulpfile.

**ALL** HTML tags, including meta and links tags must be changed to self closing.

### Table properties
These properties below need manually adding to the tempaltes. As there's a conflict with the plugin which prevents manual table property inlining and width injection from working correctly:
`border="0" cellpadding="0" cellspacing="0"`

### CSS
The text align and vertical align used in CSS are added as HTML properties to your tables
